<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.116.1"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple-touch-icon.png><meta itemprop=name content="Rust实现MD5加密并打包成WebAssembly调用"><meta itemprop=description content="有钱说什么都是硬道理，没钱说什么都是吹牛逼。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://blog.jiandan.cf/imgs/babiwawa.png"><meta itemprop=keywords content="rust,wasm"><meta property="og:type" content="article"><meta property="og:title" content="Rust实现MD5加密并打包成WebAssembly调用"><meta property="og:description" content="有钱说什么都是硬道理，没钱说什么都是吹牛逼。"><meta property="og:image" content="/imgs/babiwawa.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blog.jiandan.cf/post/develop/rust-wasm-md5/"><meta property="og:site_name" content="爸比娃娃的博客"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="爸比娃娃"><meta property="article:published_time" content="2023-01-04 00:00:00 +0000 UTC"><meta property="article:modified_time" content="2023-01-04 00:00:00 +0000 UTC"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.ad1ea33a63f63e6a94f5de191c205129577cfd392e2e10dec0f173ca5bdf0b7b.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"rust-wasm-md5","permalink":"https://blog.jiandan.cf/post/develop/rust-wasm-md5/","title":"Rust实现MD5加密并打包成WebAssembly调用","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>Rust实现MD5加密并打包成WebAssembly调用 - 爸比娃娃的博客</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>爸比娃娃的博客</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>爸比娃娃的博客</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-flinks"><a href=/flinks.html class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>友情链接</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>125</span></a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#使用-wasm-packhttpsrustwasmgithubiowasm-packinstaller-打包-rust-为-wasm-文件>使用 <a href=https://rustwasm.github.io/wasm-pack/installer/>wasm-pack</a> 打包 rust 为 wasm 文件</a><ul><li><a href=#构建-rust-lib>构建 rust lib</a></li><li><a href=#打包>打包</a></li><li><a href=#运行>运行</a></li></ul></li><li><a href=#rust-实现-md5-算法>Rust 实现 MD5 算法</a></li><li><a href=#在项目中使用>在项目中使用</a></li><li><a href=#思考为何不使用-js-的-md5-而是-wasm-的-md5>思考：为何不使用 js 的 md5 而是 wasm 的 md5</a></li><li><a href=#相关链接>相关链接</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=爸比娃娃 src=/imgs/img-lazy-loading.gif data-src=/imgs/babiwawa.png><p class=site-author-name itemprop=name>爸比娃娃</p><div class=site-description itemprop=description>有钱说什么都是硬道理，没钱说什么都是吹牛逼。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>125</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>4</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>117</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/babiwawa title="Github → https://github.com/babiwawa" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span>
<span class=links-of-social-item><a href=mailto:1223112302@qq.com title="E-Mail → mailto:1223112302@qq.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail</a></span>
<span class=links-of-social-item><a href=https://www.zhihu.com/people/hbalnw title="知乎 → https://www.zhihu.com/people/hbalnw" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://jiandan.cf title=https://jiandan.cf target=_blank>简单导航</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=0001-01-01T00:00:00+00:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=287557></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=640></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2023-01-04T00:00:00+00:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=goto-gtranslate class=button title=直达底部><i class="fas fa-arrow-down"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/babiwawa rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script>
<script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blog.jiandan.cf/post/develop/rust-wasm-md5/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/babiwawa.png"><meta itemprop=name content="爸比娃娃"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="爸比娃娃"><meta itemprop=description content="有钱说什么都是硬道理，没钱说什么都是吹牛逼。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Rust实现MD5加密并打包成WebAssembly调用"><meta itemprop=description content="我初识 WebAssembly 是当初想要分析某个网站的加密算法，最终定位到了一个 .wasm 文件，没错，这个就是 WebAssembly 的构建产物，能够直接运行在浏览器中。在我当时看来这门技术很"></span><header class=post-header><h1 class=post-title itemprop="name headline">Rust实现MD5加密并打包成WebAssembly调用</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text title=发表于>发表于：</span>
<time title="创建时间：2023-01-04 00:00:00 +0000 UTC" itemprop="dateCreated datePublished" datetime="2023-01-04 00:00:00 +0000 UTC">2023-01-04</time></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span>
<span>1701</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>4分钟</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span id=busuanzi_value_page_pv data-path=/post/develop/rust-wasm-md5/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><img src=https://img.kuizuo.cn/wasm-ferris.png width=230 height=150><p>我初识 WebAssembly 是当初想要分析某个网站的加密算法，最终定位到了一个 <code>.wasm</code> 文件，没错，这个就是 WebAssembly 的构建产物，能够直接运行在浏览器中。在我当时看来这门技术很先进，不过如今看来绝大多数的 web 应用貌似都没使用上，迄今为止我也只在这个网站中看到使用 WebAssembly 的（也许有很多，只是没实质分析过）。</p><p>恰好最近正在接触 Rust，而 Rust 开发 WebAssembly 也非常方便，因此本文算是我对 Rust + WebAssembly 的初探。</p><p>有关
<a href=https://developer.mozilla.org/zh-CN/docs/WebAssembly title="WebAssembly " rel="noopener external nofollow noreferrer" target=_blank class=exturl>WebAssembly
<i class="fa fa-external-link-alt"></i>
</a>不做过多介绍，你可以到
<a href=https://developer.mozilla.org/zh-CN/docs/WebAssembly title=MDN rel="noopener external nofollow noreferrer" target=_blank class=exturl>MDN
<i class="fa fa-external-link-alt"></i></a> 中查看相关介绍。本文重点于 Rust + WebAssembly 实践与相关工具，在
<a href=https://github.com/rustwasm title="Rust and WebAssembly (github.com)" rel="noopener external nofollow noreferrer" target=_blank class=exturl>Rust and WebAssembly (github.com)
<i class="fa fa-external-link-alt"></i></a> 或
<a href=https://github.com/rwasm title=https://github.com/rwasm rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://github.com/rwasm
<i class="fa fa-external-link-alt"></i></a> 中查看 rustwasm 相关生态。</p><h2 id=使用-wasm-packhttpsrustwasmgithubiowasm-packinstaller-打包-rust-为-wasm-文件>使用
<a href=https://rustwasm.github.io/wasm-pack/installer/ title=wasm-pack rel="noopener external nofollow noreferrer" target=_blank class=exturl>wasm-pack
<i class="fa fa-external-link-alt"></i></a> 打包 rust 为 wasm 文件
<a class=header-anchor href=#%e4%bd%bf%e7%94%a8-wasm-packhttpsrustwasmgithubiowasm-packinstaller-%e6%89%93%e5%8c%85-rust-%e4%b8%ba-wasm-%e6%96%87%e4%bb%b6></a></h2><p>下载 wasm-pack，用于将 rust 代码打包成 .wasm 文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#a6e22e>cargo</span> <span style=color:#a6e22e>install</span> <span style=color:#a6e22e>wasm</span><span style=color:#f92672>-</span><span style=color:#a6e22e>pack</span>
</span></span></code></pre></div><p>使用 cargo 有可能无法安装 wasm-pack（笔者就安装不了 openssl-sys），可以到
<a href=https://rustwasm.github.io/wasm-pack/installer/ title=wasm-pack rel="noopener external nofollow noreferrer" target=_blank class=exturl>wasm-pack
<i class="fa fa-external-link-alt"></i></a> 官网下载对应的二进制文件进行安装。</p><h3 id=构建-rust-lib>构建 rust lib
<a class=header-anchor href=#%e6%9e%84%e5%bb%ba-rust-lib></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span> cargo new --lib hello-wasm
</span></span></code></pre></div><p>将会创建 rust 库工程，并创建 <code>src/lib.rs</code>。修改为以下内容（先不必在意代码）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>crate</span> wasm_bindgen;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> wasm_bindgen::prelude::<span style=color:#f92672>*</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[wasm_bindgen]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>extern</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>alert</span>(s: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[wasm_bindgen]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>greet</span>(name: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) {
</span></span><span style=display:flex><span>    alert(<span style=color:#f92672>&amp;</span>format!(<span style=color:#e6db74>&#34;Hello, </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>!&#34;</span>, name));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>接着在 Cargo.toml 文件中添加 wasm-bindgen 依赖，<code>wasm-bindgen</code> 来提供 JavaScript 和 Rust 类型之间的桥梁，允许 JavaScript 使用字符串调用 Rust API，或调用 Rust 函数来捕获 JavaScript 异常。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>package</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;hello-wasm&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;0.1.0&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>lib</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>crate-type</span> = [<span style=color:#e6db74>&#34;cdylib&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>dependencies</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>wasm-bindgen</span> = <span style=color:#e6db74>&#34;0.2&#34;</span>
</span></span></code></pre></div><h3 id=打包>打包
<a class=header-anchor href=#%e6%89%93%e5%8c%85></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span>wasm<span style=color:#f92672>-</span>pack build
</span></span></code></pre></div><p>WebAssembly 构建产物将会输出在 pkg 目录下，如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>├─pkg
</span></span><span style=display:flex><span>|  ├─.gitignore
</span></span><span style=display:flex><span>|  ├─hello_wasm.d.ts
</span></span><span style=display:flex><span>|  ├─hello_wasm.js
</span></span><span style=display:flex><span>|  ├─hello_wasm_bg.js
</span></span><span style=display:flex><span>|  ├─hello_wasm_bg.wasm
</span></span><span style=display:flex><span>|  └─hello_wasm_bg.wasm.d.ts
</span></span></code></pre></div><p>:::note</p><p>如果想当 npm 包发布的话，可以添加 —scope 参数，将会在 pkg 下生成 package.json 文件用于发布或当做一个 npm 包来使用，这样也可以在前端工程中直接当做一个模块来导入使用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span>wasm<span style=color:#f92672>-</span>pack build <span style=color:#f92672>--</span>scope mynpmusername
</span></span></code></pre></div><p>:::</p><p>借助
<a href=https://rustwasm.github.io/wasm-pack/installer/ title=wasm-pack rel="noopener external nofollow noreferrer" target=_blank class=exturl>wasm-pack
<i class="fa fa-external-link-alt"></i></a> 可以非常轻松的将 rust 打包成 wasm，同时还提供了 js 相关支持。直接打包成 js 可导入的 npm 包，而不是让用户导入 wasm 文件然后通过浏览器 <code>WebAssembly</code> 对象来加载 WebAssembly 代码，其他语言的 WebAssembly 开发也是如此。</p><p>此外
<a href=https://rustwasm.github.io/ title=rustwasm rel="noopener external nofollow noreferrer" target=_blank class=exturl>rustwasm
<i class="fa fa-external-link-alt"></i></a> 还提供了对应的模板
<a href=https://github.com/rustwasm/wasm-pack-template title=rustwasm/wasm-pack-template rel="noopener external nofollow noreferrer" target=_blank class=exturl>rustwasm/wasm-pack-template
<i class="fa fa-external-link-alt"></i>
</a>，可以帮你省去上面的一系列配置操作，专注于你的 wasm 开发。</p><h3 id=运行>运行
<a class=header-anchor href=#%e8%bf%90%e8%a1%8c></a></h3><p>由于上面我们已经将其打包成了一个 npm 包，只需要将配置好 package.json 的依赖即可，本地的话可通过下方格式，将 pkg 目录更改为 hello-wasm，并放置在根目录下。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span>  <span style=color:#e6db74>&#34;dependencies&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;hello-wasm&#34;</span>: <span style=color:#e6db74>&#34;file:./hello-wasm&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span></code></pre></div><p>这时候就可以通过 js 直接导入使用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>const</span> js <span style=color:#f92672>=</span> import(<span style=color:#e6db74>&#34;./hello-wasm/hello_wasm.js&#34;</span>);
</span></span><span style=display:flex><span>js.then(js <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  js.greet(<span style=color:#e6db74>&#34;WebAssembly&#34;</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>在 vite 生态中有个
<a href=https://github.com/rwasm/vite-plugin-rsw title=rwasm/vite-plugin-rsw rel="noopener external nofollow noreferrer" target=_blank class=exturl>rwasm/vite-plugin-rsw
<i class="fa fa-external-link-alt"></i></a> 插件，能够在 vite 中快速使用 wasm-pack。下文中的一个应用示例也将采用该插件进行开发。</p><h2 id=rust-实现-md5-算法>Rust 实现 MD5 算法
<a class=header-anchor href=#rust-%e5%ae%9e%e7%8e%b0-md5-%e7%ae%97%e6%b3%95></a></h2><p>回到一开始的标题，在实现这个功能我一般会想 js 如何实现 MD5 算法，通常来说 MD5 算法是个比较流行的加密算法，通过搜索引擎能够快速帮我找到一份 js 的 MD5 算法。不过我更习惯通过包管理器导入的加密库，如
<a href=https://www.npmjs.com/package/crypto-js title=crypto-js rel="noopener external nofollow noreferrer" target=_blank class=exturl>crypto-js
<i class="fa fa-external-link-alt"></i>
</a>。</p><p>同理，在 rust 中可以到
<a href=https://crates.io/ title=crates.io rel="noopener external nofollow noreferrer" target=_blank class=exturl>crates.io
<i class="fa fa-external-link-alt"></i></a> 中也可以找到你想要的库，如
<a href=https://crates.io/crates/digest title=digest rel="noopener external nofollow noreferrer" target=_blank class=exturl>digest
<i class="fa fa-external-link-alt"></i>
</a>，不过我这里主要是实现 MD5 算法便使用的是
<a href=https://crates.io/crates/md-5 title=md-5 rel="noopener external nofollow noreferrer" target=_blank class=exturl>md-5
<i class="fa fa-external-link-alt"></i>
</a>。以下是我的封装代码。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> md5::{Digest, Md5};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>md5</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; String {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> hasher <span style=color:#f92672>=</span> Md5::new();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    hasher.update(input.as_bytes());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> result <span style=color:#f92672>=</span> hasher.finalize();
</span></span><span style=display:flex><span>    format!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{:x}</span><span style=color:#e6db74>&#34;</span>, result)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> result <span style=color:#f92672>=</span> md5(<span style=color:#e6db74>&#34;123456&#34;</span>);
</span></span><span style=display:flex><span>    println!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, result);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>然后将这一部分的代码替换到一开始的示例中。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>crate</span> wasm_bindgen;
</span></span><span style=display:flex><span><span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>crate</span> md5;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> wasm_bindgen::prelude::<span style=color:#f92672>*</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> md5::{Digest, Md5};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[wasm_bindgen]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>md5</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>)-&gt; String {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> hasher <span style=color:#f92672>=</span> Md5::new();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    hasher.update(input.as_bytes());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> result <span style=color:#f92672>=</span> hasher.finalize();
</span></span><span style=display:flex><span>    format!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{:x}</span><span style=color:#e6db74>&#34;</span>, result)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>此时通过 wasm-pack 将上述代码打包成 npm 包形式即可在 js 中调用 rust 提供的 md5 函数，至此就已经完成了本标题的内容了。</p><h2 id=在项目中使用>在项目中使用
<a class=header-anchor href=#%e5%9c%a8%e9%a1%b9%e7%9b%ae%e4%b8%ad%e4%bd%bf%e7%94%a8></a></h2><p>这里我所借用
<a href=https://github.com/rwasm/vite-plugin-rsw title=rwasm/vite-plugin-rsw rel="noopener external nofollow noreferrer" target=_blank class=exturl>rwasm/vite-plugin-rsw
<i class="fa fa-external-link-alt"></i></a> 插件，在 vite 中配合 wasm-pack 进行开发的一个实例。代码部分就不做解读了，有兴趣可自行到翻阅源码：
<a href=https://github.com/kuizuo/rust-wasm-md5 title=kuizuo/rust-wasm-md5 rel="noopener external nofollow noreferrer" target=_blank class=exturl>kuizuo/rust-wasm-md5
<i class="fa fa-external-link-alt"></i></a></p><p>在线地址：
<a href=http://rust-wasm-md5.kuizuo.cn/ title=http://rust-wasm-md5.kuizuo.cn rel="noopener external nofollow noreferrer" target=_blank class=exturl>http://rust-wasm-md5.kuizuo.cn
<i class="fa fa-external-link-alt"></i></a> （不保证地址长期可用）</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://img.kuizuo.cn/image__XHPNCbC-B.png alt></p><h2 id=思考为何不使用-js-的-md5-而是-wasm-的-md5>思考：为何不使用 js 的 md5 而是 wasm 的 md5
<a class=header-anchor href=#%e6%80%9d%e8%80%83%e4%b8%ba%e4%bd%95%e4%b8%8d%e4%bd%bf%e7%94%a8-js-%e7%9a%84-md5-%e8%80%8c%e6%98%af-wasm-%e7%9a%84-md5></a></h2><p>众所周知，你在浏览器中按下 F12 打开 DevTools，并选择源代码面板中就可以看到当前访问的网站的所有代码。</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://img.kuizuo.cn/image_6019y_U19n.png alt></p><p>而对于一些具有熟练度的逆向分析者中，如果不经过任何处理的代码被打包到生产环境中能够快速的定位出某个功能的具体代码位置。</p><p>而通过 wasm 就能很有效的将代码隐藏起来，不让逆向分析者查看，就像下面这样</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://img.kuizuo.cn/image_BbA3n6wFws.png alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://img.kuizuo.cn/image_81tgfDE_P7.png alt></p><p>这里我并没有将 md5 更改成不易猜测的名字，你也可自行下断点尝试一番，定位代码。当你定位到具体代码后，就会得到上图的二进制代码格式，几乎无法解读其意思。</p><p>不过虽说解读不出 wasm 的原代码（至少目前来说很难反编译成原始代码），但可以通过扣代码的方式来调用 wasm 对外提供的函数（这里为 md5 函数）。</p><p>这里仅是 wasm 的一种实际用例，更多情况下应该还是用 Wasm 来提高 web 应用性能的。</p><h2 id=相关链接>相关链接
<a class=header-anchor href=#%e7%9b%b8%e5%85%b3%e9%93%be%e6%8e%a5></a></h2><p><a href=https://developer.mozilla.org/zh-CN/docs/WebAssembly/Rust_to_wasm title="编译 Rust 为 WebAssembly - WebAssembly | MDN (mozilla.org)" rel="noopener external nofollow noreferrer" target=_blank class=exturl>编译 Rust 为 WebAssembly - WebAssembly | MDN (mozilla.org)
<i class="fa fa-external-link-alt"></i></a></p><p><a href=https://rustwasm.github.io/ title="Rust and WebAssembly" rel="noopener external nofollow noreferrer" target=_blank class=exturl>Rust and WebAssembly
<i class="fa fa-external-link-alt"></i></a></p><p><a href=https://rustmagazine.github.io/rust_magazine_2021/chapter_2/rust_wasm_frontend.html title="前端入门 ｜ Rust 和 WebAssembly - Rust 精选" rel="noopener external nofollow noreferrer" target=_blank class=exturl>前端入门 ｜ Rust 和 WebAssembly - Rust 精选
<i class="fa fa-external-link-alt"></i></a></p><p><a href=https://github.com/rwasm/vite-plugin-rsw title="rwasm/vite-plugin-rsw: 🦞 wasm-pack plugin for Vite (github.com)" rel="noopener external nofollow noreferrer" target=_blank class=exturl>rwasm/vite-plugin-rsw: 🦞 wasm-pack plugin for Vite (github.com)
<i class="fa fa-external-link-alt"></i></a></p></div><footer class=post-footer><div class=post-tags><a href=/tags/rust>rust</a>
<a href=/tags/wasm>wasm</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="爸比娃娃 - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="爸比娃娃 - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
Rust实现MD5加密并打包成WebAssembly调用</li><li class=post-copyright-author><strong>本文作者：</strong>
爸比娃娃</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://blog.jiandan.cf/post/develop/rust-wasm-md5/ title=Rust实现MD5加密并打包成WebAssembly调用>https://blog.jiandan.cf/post/develop/rust-wasm-md5/</a></li><li class=post-copyright-license><strong>版权声明：</strong>
本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i></span>
<span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/atom.xml><span class=icon><i class="fa fa-rss"></i></span>
<span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/frontend-devs-must-know-websites/ rel=next title=11个前端工程师必备的网站><i class="fa fa-chevron-left"></i> 11个前端工程师必备的网站</a></div><div class="post-nav-prev post-nav-item"><a href=/post/reference/2022-year-end-summary/ rel=prev title=2022年终总结——从逆向转Web开发>2022年终总结——从逆向转Web开发
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=waline-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>爸比娃娃</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.116.1 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>粤ICP备 18047355-1 号</a>
<img src=/imgs/gongan.png alt=沪公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011402009770" target=_blank>沪公网安备 31011402009770 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel></a>
<a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云></a>
<a target=_blank href=https://webify.cloudbase.net title=Webify>Webify</a>
<span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://blog.jiandan.cf/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o \n\n可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄\n(Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.0fb3547374c917d23a2e5f762b70f3698d20b46a01cc18c38f9c467aeffc99fc.js defer></script></body></html>