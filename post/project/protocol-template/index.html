<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.116.1"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple-touch-icon.png><meta itemprop=name content="Protocol 协议复现模板"><meta itemprop=description content="一个用于快速复现请求协议的 Web 开发模板。基于 Nuxt3 开发，并集成了NaiveUI，Unocss，等相关工具库封装。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://blog.jiandan.cf/imgs/babiwawa.png"><meta itemprop=keywords content="project,protocol,template,nuxt3"><meta property="og:type" content="article"><meta property="og:title" content="Protocol 协议复现模板"><meta property="og:description" content="一个用于快速复现请求协议的 Web 开发模板。基于 Nuxt3 开发，并集成了NaiveUI，Unocss，等相关工具库封装。"><meta property="og:image" content="/imgs/babiwawa.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blog.jiandan.cf/post/project/protocol-template/"><meta property="og:site_name" content="爸比娃娃的博客"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="爸比娃娃"><meta property="article:published_time" content="2022-10-30 00:00:00 +0000 UTC"><meta property="article:modified_time" content="2022-10-30 00:00:00 +0000 UTC"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.ad1ea33a63f63e6a94f5de191c205129577cfd392e2e10dec0f173ca5bdf0b7b.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"protocol-template","permalink":"https://blog.jiandan.cf/post/project/protocol-template/","title":"Protocol 协议复现模板","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>Protocol 协议复现模板 - 爸比娃娃的博客</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>爸比娃娃的博客</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>爸比娃娃的博客</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-flinks"><a href=/flinks.html class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>友情链接</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>125</span></a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#为什么我要写这样的一个模板网站>为什么我要写这样的一个模板(网站)</a></li><li><a href=#技术栈>技术栈</a></li><li><a href=#目录结构>目录结构</a></li><li><a href=#基本功能><strong>基本功能</strong></a><ul><li><a href=#全栈开发>全栈开发</a></li><li><a href=#类型提示>类型提示</a></li><li><a href=#工具库>工具库</a></li><li><a href=#数据库>数据库</a></li><li><a href=#用户凭证存储>用户凭证存储</a></li><li><a href=#更新日志与帮助说明>更新日志与帮助说明</a></li><li><a href=#打包与部署>打包与部署</a></li></ul></li><li><a href=#开发流程形态><strong>开发流程（形态）</strong></a><ul><li><a href=#修改内容>修改内容</a></li><li><a href=#定义协议复现逻辑代码重要><strong>定义协议复现逻辑代码（重要）</strong></a></li><li><a href=#定义后端数据接口>定义后端数据接口</a></li><li><a href=#定义前端状态管理>定义前端状态管理</a></li><li><a href=#编写前端页面与组件>编写前端页面与组件</a></li><li><a href=#流程总结>流程总结</a></li></ul></li><li><a href=#一些问题>一些问题</a><ul><li><a href=#遇到图片防盗链怎么办>遇到图片防盗链怎么办?</a></li><li><a href=#跨域问题>跨域问题</a></li></ul></li><li><a href=#考虑做的>考虑做的</a><ul><li><a href=#编写一个后台管理系统>编写一个后台管理系统</a></li><li><a href=#使用-tauri-编译跨平台程序>使用 tauri 编译跨平台程序</a></li></ul></li><li><a href=#写在最后>写在最后</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=爸比娃娃 src=/imgs/img-lazy-loading.gif data-src=/imgs/babiwawa.png><p class=site-author-name itemprop=name>爸比娃娃</p><div class=site-description itemprop=description>有钱说什么都是硬道理，没钱说什么都是吹牛逼。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>125</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>4</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>117</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/babiwawa title="Github → https://github.com/babiwawa" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span>
<span class=links-of-social-item><a href=mailto:1223112302@qq.com title="E-Mail → mailto:1223112302@qq.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail</a></span>
<span class=links-of-social-item><a href=https://www.zhihu.com/people/hbalnw title="知乎 → https://www.zhihu.com/people/hbalnw" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://jiandan.cf title=https://jiandan.cf target=_blank>简单导航</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=0001-01-01T00:00:00+00:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=287557></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=640></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2023-01-04T00:00:00+00:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=goto-gtranslate class=button title=直达底部><i class="fas fa-arrow-down"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/babiwawa rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script>
<script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blog.jiandan.cf/post/project/protocol-template/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/babiwawa.png"><meta itemprop=name content="爸比娃娃"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="爸比娃娃"><meta itemprop=description content="有钱说什么都是硬道理，没钱说什么都是吹牛逼。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Protocol 协议复现模板"><meta itemprop=description content="一个用于快速复现请求协议的 Web 开发模板。基于 Nuxt3 开发，并集成了NaiveUI，Unocss，等相关工具库封装。"></span><header class=post-header><h1 class=post-title itemprop="name headline">Protocol 协议复现模板</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text title=发表于>发表于：</span>
<time title="创建时间：2022-10-30 00:00:00 +0000 UTC" itemprop="dateCreated datePublished" datetime="2022-10-30 00:00:00 +0000 UTC">2022-10-30</time></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span>
<span>5897</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>12分钟</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span id=busuanzi_value_page_pv data-path=/post/project/protocol-template/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p align=center><img src=https://api.kuizuo.cn/api/icon/carbon:api.svg width=80 height=80></p><p align=center><i>Artwork from <a href=https://v3.nuxtjs.org/>Nuxt3</a></i></p><h1 align=center>Protocol</h1><p align=center>🧪 一个用于快速复现请求协议的 Web 开发模板。</p><p align=center><a href=https://github.com/kuizuo/protocol><img src="https://img.shields.io/github/stars/kuizuo/protocol?style=social" alt="GitHub stars"></a>
<a href=https://protocol.kuizuo.cn>🖥 在线预览</a>
<a href=https://stackblitz.com/github/kuizuo/protocol><img src=https://developer.stackblitz.com/img/open_in_stackblitz.svg></a></p><br><h2 id=为什么我要写这样的一个模板网站>为什么我要写这样的一个模板(网站)
<a class=header-anchor href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e6%88%91%e8%a6%81%e5%86%99%e8%bf%99%e6%a0%b7%e7%9a%84%e4%b8%80%e4%b8%aa%e6%a8%a1%e6%9d%bf%e7%bd%91%e7%ab%99></a></h2><p>我曾经是做 API 请求的，经常要模拟某些请求（协议复现）。所以写过比较多的 api 请求代码，在此期间尝试编写过许多代码方式和软件形态。但都不令我满意，不是过于繁琐，就是开发太慢，都达不到我想要的预期。尤其是开发体验，可以说是苦不堪言。</p><p>就在前段时间接触了 SSR 框架（Nuxt3）与 Serverless Function，并用其写了一些项目，如
<a href=https://github.com/kuizuo/api-service title=api-service rel="noopener external nofollow noreferrer" target=_blank class=exturl>api-service
<i class="fa fa-external-link-alt"></i></a> 。而
<a href=https://7y8y.vercel.app title=某了个羊刷次数的网站 rel="noopener external nofollow noreferrer" target=_blank class=exturl>某了个羊刷次数的网站
<i class="fa fa-external-link-alt"></i>
</a>的实现，则让我意外发现这貌似就是我理想中的的协议复现最佳实现？于是我立马开启了 VSCode，将我的这一想法用代码的方式来实现出来，在经历了两周几乎不间断的开发，最终达到了我的预期效果！</p><p>在
<a href=https://kuizuo.cn/request-protocol-scheme title=模拟请求|协议复现方案 rel="noopener external nofollow noreferrer" target=_blank class=exturl>模拟请求|协议复现方案
<i class="fa fa-external-link-alt"></i></a> 这篇文章中我对协议复现的一些方案总结，而这篇就是对 SSR 框架方案的一个具体实践。</p><h2 id=技术栈>技术栈
<a class=header-anchor href=#%e6%8a%80%e6%9c%af%e6%a0%88></a></h2><p>这个模板基于
<a href=https://v3.nuxtjs.org/ title=Nuxt3 rel="noopener external nofollow noreferrer" target=_blank class=exturl>Nuxt3
<i class="fa fa-external-link-alt"></i>
</a>开发的，该框架拥有全栈开发能力（即全栈框架），并有诸多
<a href=https://modules.nuxtjs.org/ title=模块 rel="noopener external nofollow noreferrer" target=_blank class=exturl>模块
<i class="fa fa-external-link-alt"></i>
</a>，即装即用。同时由于采用<code>Serverless Function</code> 方式来定义 api 接口，可以轻易地部署在自有服务器或
<a href=https://vercel.com title=Vercel rel="noopener external nofollow noreferrer" target=_blank class=exturl>Vercel
<i class="fa fa-external-link-alt"></i>
</a>，
<a href=https://www.netlify.com/ title=Netlify rel="noopener external nofollow noreferrer" target=_blank class=exturl>Netlify
<i class="fa fa-external-link-alt"></i>
</a>这样的平台上。由于要做到敏捷开发，该模板集成了
<a href=https://www.naiveui.com/ title="Naive UI" rel="noopener external nofollow noreferrer" target=_blank class=exturl>Naive UI
<i class="fa fa-external-link-alt"></i></a> 组件库，组件库的质量足够胜任常规前端业务开发。此外还封装了一些我个人的所用到的工具库以提高开发效率。</p><p>为此我给这个模板起名 Protocol，即协议，也可以认为是礼仪。<strong>一个用于快速复现请求协议的 Web 开发模板。</strong></p><p>废话不多数，就正式来介绍下
<a href=https://github.com/kuizuo/protocol title=Protocol rel="noopener external nofollow noreferrer" target=_blank class=exturl>Protocol
<i class="fa fa-external-link-alt"></i>
</a>。</p><h2 id=目录结构>目录结构
<a class=header-anchor href=#%e7%9b%ae%e5%bd%95%e7%bb%93%e6%9e%84></a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>protocol
</span></span><span style=display:flex><span>├── assets <span style=color:#75715e># 前端静态资源文件</span>
</span></span><span style=display:flex><span>├── components <span style=color:#75715e># 组件</span>
</span></span><span style=display:flex><span>├── composables <span style=color:#75715e># 组合式API</span>
</span></span><span style=display:flex><span>├── content <span style=color:#75715e># content 模块</span>
</span></span><span style=display:flex><span>│   ├── changelog.md <span style=color:#75715e># 更新日志</span>
</span></span><span style=display:flex><span>│   └── help.md <span style=color:#75715e># 帮助说明</span>
</span></span><span style=display:flex><span>├── data <span style=color:#75715e># 持久化数据</span>
</span></span><span style=display:flex><span>│   └── db
</span></span><span style=display:flex><span>├── layouts <span style=color:#75715e># 布局</span>
</span></span><span style=display:flex><span>├── nuxt.config.ts <span style=color:#75715e># nuxt 配置文件</span>
</span></span><span style=display:flex><span>├── package.json <span style=color:#75715e># 依赖包</span>
</span></span><span style=display:flex><span>├── pages <span style=color:#75715e># 页面</span>
</span></span><span style=display:flex><span>├── plugins <span style=color:#75715e># 插件</span>
</span></span><span style=display:flex><span>├── public <span style=color:#75715e># 服务端静态资源文件</span>
</span></span><span style=display:flex><span>│   └── logo.svg
</span></span><span style=display:flex><span>├── server <span style=color:#75715e># 服务端文件</span>
</span></span><span style=display:flex><span>│   ├── api <span style=color:#75715e># 后端接口</span>
</span></span><span style=display:flex><span>│   └── protocol <span style=color:#75715e># 协议请求逻辑代理</span>
</span></span><span style=display:flex><span>├── stores <span style=color:#75715e># pinia 状态管理</span>
</span></span><span style=display:flex><span>│   └── user.ts <span style=color:#75715e># 用户状态</span>
</span></span><span style=display:flex><span>├── types <span style=color:#75715e># 类型定义</span>
</span></span><span style=display:flex><span>│   └── user.d.ts <span style=color:#75715e># 用户类型声明文件</span>
</span></span><span style=display:flex><span>├── ecosystem.config.js <span style=color:#75715e># pm2 配置文件</span>
</span></span><span style=display:flex><span>├── nitro.config.ts <span style=color:#75715e># nitro 配置文件</span>
</span></span><span style=display:flex><span>├── app.config.ts <span style=color:#75715e># 前端配置文件</span>
</span></span><span style=display:flex><span>└── app.vue <span style=color:#75715e># 入口文件</span>
</span></span></code></pre></div><p>从这个项目的目录结构中其实就可以看出，本项目是集成了<strong>全栈</strong>能力，并且使用 Vue 与 Node 来编写前端与后端，并<strong>不会产生前后端分离的分割感</strong>，只需要打开一个项目即可开始工作。这得益于
<a href=https://v3.nuxtjs.org/ title=Nuxt3 rel="noopener external nofollow noreferrer" target=_blank class=exturl>Nuxt3
<i class="fa fa-external-link-alt"></i></a> 与
<a href=https://nitro.unjs.io/ title=Nitro rel="noopener external nofollow noreferrer" target=_blank class=exturl>Nitro
<i class="fa fa-external-link-alt"></i>
</a>。</p><p>由于是基于 Nuxt3 开发的，所以使用该项目是需要一些 SSR 开发经验。如果你还没有接触 SSR，可以根据你熟悉的前端框架选择对应的 SSR 框架来尝试体验一番。<del>都要 2023 年了，不会还有前端程序员没用过 SSR 框架吧。</del></p><h2 id=基本功能><strong>基本功能</strong>
<a class=header-anchor href=#%e5%9f%ba%e6%9c%ac%e5%8a%9f%e8%83%bd></a></h2><h3 id=全栈开发>全栈开发
<a class=header-anchor href=#%e5%85%a8%e6%a0%88%e5%bc%80%e5%8f%91></a></h3><p>这里我不想过多介绍 Nuxt3 的基本功能与使用，在我的一个
<a href=https://kuizuo.cn/use-nuxt3-build-api-server#nuxt3-%e4%bb%8b%e7%bb%8d title="基于 Nuxt3 的 API 接口服务网站" rel="noopener external nofollow noreferrer" target=_blank class=exturl>基于 Nuxt3 的 API 接口服务网站
<i class="fa fa-external-link-alt"></i></a> 的项目中，有简单介绍过 Nuxt3，有兴趣可以去看看。</p><p>这里你只需要知道 Nuxt3 具有全栈开发的能力，如果你想，完成可以基于 Nuxt3 这个技术栈来实现 Web 开发的前端后端工作。</p><h3 id=类型提示>类型提示
<a class=header-anchor href=#%e7%b1%bb%e5%9e%8b%e6%8f%90%e7%a4%ba></a></h3><p>首先，最重要的就是类型提示，对于大多数 api 请求而言，类型往往常被忽略。这就导致不知道这个请求的提交参数、响应结果有什么数据字段。举个例子</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://img.kuizuo.cn/image_75GsdEZuLK.png alt></p><p>这是一个 post 请求用于实现登录的，但是这个响应数据 data 没有任何具体提示（这里的提示是 vscode 记录用户常输入的提示），这时候如果一旦拼接错误，就会导致某个数据没拿到，从而诱发 bug。同理提交的请求体 body 不做约束，万一这个请求还有验证码 code 参数，但是我没写上，那请求就会失败，这是就需要通过调试输出，甚至需要抓包比对原始数据包才能得知。</p><p>最主要的是没有类型约束的情况下，非常容易出现出现访问的对象属性不存在，做 js 开发的肯定经常遇到如下错误提示。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>Uncaught</span> <span style=color:#a6e22e>TypeError</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Cannot</span> <span style=color:#a6e22e>read</span> <span style=color:#a6e22e>properties</span> <span style=color:#66d9ef>of</span> <span style=color:#66d9ef>undefined</span> (<span style=color:#a6e22e>reading</span> <span style=color:#e6db74>&#39;data&#39;</span>)
</span></span></code></pre></div><p>有太多很多时候就是因为没有类型，无形间诱发 bug。就极易造成开发疲惫，不愿维护代码，这也是很多做 api 接口都常常忽视的一点。包括我之前也是同样如此。</p><p>对于 js 而言，上述情况自然是解决不了，但这种场景对于 ts 来说在适合不过了。所以 Protocol 自然是集成了 ts，并且有良好的类型提示。下面展示几张开发时的截图就能体会到，当然你前提是得会 ts 或者看的懂 ts。</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://img.kuizuo.cn/image_VbEuizLRfz.png alt></p><p>上面的类型提示演示代码仅仅作为体现类型的好处，将类型定义（interface，type 等）和核心逻辑都在同一个文件自然不好，容易造成代码冗余。实际开发中，更多使用命名空间，将类型写到 ts 声明文件.d.ts 中。比如将上面的改写后如下</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://img.kuizuo.cn/image_48-YSpYd1g.png alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://img.kuizuo.cn/image_9b9ns2BM67.png alt></p><p>就在我写这篇文章做代码演示的时候，又发生了拼写错误，如下图。由于使用 ts 类型与 eslint，所以在开发时的问题我就能立马发现，而不是到了运行时才提示错误。</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://img.kuizuo.cn/image_PfpxCKZomB.png alt></p><p><strong>有了类型提示能非常有效的避免上述问题</strong>。同时 ts 并不像 java 那样的强类型语言，你完全可以选择是否编写 ts 的类型（type 或 interfere），这由你决定，你乐意都可以将 typescript 写成 anyscript，因为确实有些人确实不喜欢写类型。</p><p>ts 的类型提示仅是其次，此外还配置了 eslint 对代码检查，让代码在 2 个空格缩进，无分号，单引号等代码规范下。保证代码质量，而不会出现这边一个分号，那边来个双引号的情况。</p><h3 id=工具库>工具库
<a class=header-anchor href=#%e5%b7%a5%e5%85%b7%e5%ba%93></a></h3><p>要想在实际项目中使用，还需要做很多功课，例如数据格式转换，编码，加解密，cookie 存储，IP 代理等等。这段时间也特此对常用工具封装成 npm 包，也就是
<a href=https://www.npmjs.com/package/@kuizuo/http title=@kuizuo/http rel="noopener external nofollow noreferrer" target=_blank class=exturl>@kuizuo/http
<i class="fa fa-external-link-alt"></i></a> 与
<a href=https://www.npmjs.com/package/@kuizuo/utils title=@kuizuo/utils rel="noopener external nofollow noreferrer" target=_blank class=exturl>@kuizuo/utils
<i class="fa fa-external-link-alt"></i>
</a>。</p><p>大部分的代码我都会采用最新的 ECMAScript 标准来编写，目的也是为了简化代码，减少不必要的负担。</p><h3 id=数据库>数据库
<a class=header-anchor href=#%e6%95%b0%e6%8d%ae%e5%ba%93></a></h3><p>既然是全栈框架，那么必然少不了数据库的存取，
<a href=https://nitro.unjs.io/guide/introduction/storage title=nitro rel="noopener external nofollow noreferrer" target=_blank class=exturl>nitro
<i class="fa fa-external-link-alt"></i></a> 自然是提供了数据存储选择，即
<a href=https://github.com/unjs/unstorage#http-universal title=unjs/unstorage rel="noopener external nofollow noreferrer" target=_blank class=exturl>unjs/unstorage
<i class="fa fa-external-link-alt"></i>
</a>。使用特别简单：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>useStorage</span>().<span style=color:#a6e22e>setItem</span>(<span style=color:#e6db74>&#39;test:foo&#39;</span>, {<span style=color:#a6e22e>hello</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;world&#39;</span>});
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>useStorage</span>().<span style=color:#a6e22e>getItem</span>(<span style=color:#e6db74>&#39;test:foo&#39;</span>);
</span></span></code></pre></div><p>不指定则使用内存，当然了想要持久化配置，
<a href=https://nitro.unjs.io/guide/introduction/storage#defining-mountpoints title=nitro rel="noopener external nofollow noreferrer" target=_blank class=exturl>nitro
<i class="fa fa-external-link-alt"></i></a> 也提供了相关配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// nitro.config.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> {<span style=color:#a6e22e>defineNitroConfig</span>} <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;nitropack&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>defineNitroConfig</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>storage</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>redis</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>driver</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;redis&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#75715e>/* redis connector options */</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>db</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>driver</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;fs&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>base</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./data/db&#39;</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>并根据不同前缀（根据 nitro.config.ts 中的 storage 对象的属性）存储在不同存储位置，如</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// 存内存缓存中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>useStorage</span>().<span style=color:#a6e22e>setItem</span>(<span style=color:#e6db74>&#39;cache:foo&#39;</span>, {<span style=color:#a6e22e>hello</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;world&#39;</span>});
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>useStorage</span>().<span style=color:#a6e22e>getItem</span>(<span style=color:#e6db74>&#39;cache:foo&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 存db中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>useStorage</span>().<span style=color:#a6e22e>setItem</span>(<span style=color:#e6db74>&#39;db:foo&#39;</span>, {<span style=color:#a6e22e>hello</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;world&#39;</span>});
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>useStorage</span>().<span style=color:#a6e22e>getItem</span>(<span style=color:#e6db74>&#39;db:foo&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 存redis中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>useStorage</span>().<span style=color:#a6e22e>setItem</span>(<span style=color:#e6db74>&#39;redis:foo&#39;</span>, {<span style=color:#a6e22e>hello</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;world&#39;</span>});
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>useStorage</span>().<span style=color:#a6e22e>getItem</span>(<span style=color:#e6db74>&#39;redis:foo&#39;</span>);
</span></span></code></pre></div><p>从目前来看，
<a href=https://github.com/unjs/unstorage#http-universal title=unjs/unstorage rel="noopener external nofollow noreferrer" target=_blank class=exturl>unjs/unstorage
<i class="fa fa-external-link-alt"></i>
</a>并没有提供 sql 数据库的方案。不过对于这类项目而言，似乎也没有上 sql 数据库的必要，文件和 redis 就足以了。如果需要也可以
<a href=https://github.com/unjs/unstorage#making-custom-drivers title="自定义 drivers" rel="noopener external nofollow noreferrer" target=_blank class=exturl>自定义 drivers
<i class="fa fa-external-link-alt"></i>
</a>。</p><p>:::caution 注意</p><p>由于 Vercel 是不支持文件读写的，所以想要文件方式数据存储功能就行不通，需要更换存储方案，比如远程 redis 数据库。</p><p>如果是部署到自由的服务器（通常是 Linux 系统），则需要分配相应的读写权限。</p><p>:::</p><h3 id=用户凭证存储>用户凭证存储
<a class=header-anchor href=#%e7%94%a8%e6%88%b7%e5%87%ad%e8%af%81%e5%ad%98%e5%82%a8></a></h3><p>通常来说，有两种用户凭证，Cookie 和 Token，有了上述数据存储的方案，存取用户凭证并不是什么难题。不过用户凭证更多的是用来鉴权的，这时候就需要配置前端
<a href=https://v3.nuxtjs.org/guide/directory-structure/middleware#middleware-directory title=Middleware rel="noopener external nofollow noreferrer" target=_blank class=exturl>Middleware
<i class="fa fa-external-link-alt"></i></a> 和后端
<a href=https://v3.nuxtjs.org/guide/directory-structure/server#server-middleware title=Middleware rel="noopener external nofollow noreferrer" target=_blank class=exturl>Middleware
<i class="fa fa-external-link-alt"></i>
</a>，至于选择哪种，根据实际网站情况来选择即可。</p><h3 id=更新日志与帮助说明>更新日志与帮助说明
<a class=header-anchor href=#%e6%9b%b4%e6%96%b0%e6%97%a5%e5%bf%97%e4%b8%8e%e5%b8%ae%e5%8a%a9%e8%af%b4%e6%98%8e></a></h3><p>我提供了两个 md 页面，更新日志（ChangeLog）和帮助说明（Usage），如果需要更新内容，在根目录下 <code>content</code> 文件夹中找到对应文件修改即可。</p><p>如果你想在创建新的 md 页面只需要在 content 中新建一个文件（如test.md），在页面路由创建同名vue文件(test.vue)，将下方的 path 修改相应文件名即可。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>setup</span> <span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ts&#34;</span>&gt;
</span></span><span style=display:flex><span><span style=color:#a6e22e>definePageMeta</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>layout</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;markdown&#39;</span>,
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>template</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>ContentDoc</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;prose text-left&#34;</span> <span style=color:#a6e22e>path</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/test&#34;</span> /&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>template</span>&gt;
</span></span></code></pre></div><h3 id=打包与部署>打包与部署
<a class=header-anchor href=#%e6%89%93%e5%8c%85%e4%b8%8e%e9%83%a8%e7%bd%b2></a></h3><p>传统的 node 后端框架，通常需要将原文件或者打包后的文件放到服务器上，执行 <code>npm i</code> 下载 <code>package.json</code> 里的依赖文件，然后执行运行命令启动。这一步骤的下载依赖就尤为致命，因为通常下载依赖将会特别耗时。</p><p>但 Nuxt3 则是会将前后端的资源文件，打包到 <code>.output</code> 文件夹下，以本项目为例，打包的大小为 14.6MB,gzip 压缩为 3.11MB（写本章时的记录），如果不使用
<a href=https://content.nuxtjs.org/ title=Content rel="noopener external nofollow noreferrer" target=_blank class=exturl>Content
<i class="fa fa-external-link-alt"></i></a> 模块体积将会更小。打包完成提示如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>Σ Total size: 14.6 MB <span style=color:#f92672>(</span>3.11 MB gzip<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>√ You can preview this build using node .output/server/index.mjs
</span></span></code></pre></div><p>然后你只需要将 <code>.output</code> 整个文件夹放到服务器上，并且安装好 node 环境，输入 <code>node .output/server/index.mjs</code> 即可启动项目，默认端口为 3000。当然也可以通过 pm2 的配置文件来启动，配置文件如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>apps</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Protocol&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>exec_mode</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;cluster&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>instances</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;1&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>env</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>NITRO_PORT</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>8010</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>NITRO_HOST</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;localhost&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>NODE_ENV</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;production&#39;</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>script</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./.output/server/index.mjs&#39;</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>接着执行 <code>pm2 start ecosystem.config.js --env production</code> 即可运行。相比传统需要手动下载依赖的方式，Nuxt3 则是直接将 web 项目实际所需要的依赖都打包在一起，只需要在有 node 环境下机器中就可以立马运行，无需等待依赖下载。</p><p>如果部署在 Vercel 或 Netlify 就更轻松了，根据官方的步骤即可做到一键部署。</p><h2 id=开发流程形态><strong>开发流程（形态）</strong>
<a class=header-anchor href=#%e5%bc%80%e5%8f%91%e6%b5%81%e7%a8%8b%e5%bd%a2%e6%80%81></a></h2><p>介绍完工具库，如果不介绍下开发流程，很多人都不知道该如何起手，这里我会用 Github 的 api 作为案例演示，也就是模板源代码中所演示的那样。当然，后续我会根据一些实战项目考虑弄个案例展示（在写中），以来方便使用与完善该模板。毕竟如果开发者自己都不愿意用，又怎么去说服他人来使用呢。</p><h3 id=修改内容>修改内容
<a class=header-anchor href=#%e4%bf%ae%e6%94%b9%e5%86%85%e5%ae%b9></a></h3><p>如何修改某文字内容或某图标，这里就不再赘述了，Ctrl + Shift + F 搜索你想修改的内容并修改即可。大部分能修改的配置都写在了 <code>app.config.ts</code> 下。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>defineAppConfig</span>({ <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Protocol&#39;</span>, <span style=color:#a6e22e>description</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;一个用于快速复现请求协议的Web开发模板。&#39;</span>, <span style=color:#a6e22e>author</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;kuizuo&#39;</span>, <span style=color:#a6e22e>link</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;https://github.com/kuizuo&#39;</span>, <span style=color:#a6e22e>qq</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;https://im.qq.com/&#39;</span>, <span style=color:#a6e22e>wx</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;https://wx.qq.com/&#39;</span>,
</span></span><span style=display:flex><span>}, })
</span></span></code></pre></div><p>通过 <code>const appConfig = useAppConfig()</code> 获取配置对象数据。</p><h3 id=定义协议复现逻辑代码重要><strong>定义协议复现逻辑代码（重要）</strong>
<a class=header-anchor href=#%e5%ae%9a%e4%b9%89%e5%8d%8f%e8%ae%ae%e5%a4%8d%e7%8e%b0%e9%80%bb%e8%be%91%e4%bb%a3%e7%a0%81%e9%87%8d%e8%a6%81></a></h3><p>这里以调用 Github 的 api 为例，因为业务相对简单，所以使用的是静态方法来调用，简单展示一下代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>AHttp</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@kuizuo/http&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>http</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>AHttp</span>({ <span style=color:#a6e22e>baseURL</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;https://api.github.com&#39;</span> })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Github</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getUser</span>(<span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>data</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>get</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>API</span>.<span style=color:#a6e22e>User</span><span style=color:#f92672>&gt;</span>(<span style=color:#e6db74>`/users/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>username</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>data</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getRepos</span>(<span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>data</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>get</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>API</span>.<span style=color:#a6e22e>Repo</span>[]<span style=color:#f92672>&gt;</span>(<span style=color:#e6db74>`/users/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>username</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/repos`</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>data</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>我个人是习惯也喜欢将逻辑部分用
<a href=https://es6.ruanyifeng.com/#docs/class title=class rel="noopener external nofollow noreferrer" target=_blank class=exturl>class
<i class="fa fa-external-link-alt"></i></a> 的方式来编写，也推荐用这种去定义这些业务逻辑代码。这里我举个例子来说明，假设现在有一个博客网站，有登陆、获取博文列表、评论等功能。那么我会这么写</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>AHttp</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@kuizuo/http&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>password</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Blog</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>http</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>AHttp</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>user</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>user</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>User</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>http</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>AHttp</span>({ <span style=color:#a6e22e>baseURL</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;https://blog.kuizuo.cn&#39;</span> })
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>user</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>login</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// login logic code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getBlogList</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// getBlogList logic code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>comment</span>(<span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>number</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// comment logic code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>定义完这些后，我只需要实例化一个对象 account，调用 login 方法即可登录，后续的获取博文列表与评论操作我只需要拿这个 account 来操作即可。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>account</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Blog</span>({<span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;kuizuo&#39;</span>, <span style=color:#a6e22e>password</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;123456&#39;</span>});
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>login</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>blogList</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>getBlogList</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>comment</span>(<span style=color:#ae81ff>1</span>);
</span></span></code></pre></div><p>如果想换一个账号操作，就需要重新按照上面的方式实例化一个新的对象，拿这个对象操作即可。</p><p>并且这种方式在迁移代码的时候尤为方便，可以直接将这份代码放到不同的 Node 项目中来运行。</p><p>通常也是在这一流程中，会编写大量的类型代码，来完善整个项目，保证代码的健壮。通常我会在同文件下或者在 types 下定义 <code>.d.ts</code> 声明文件，通过声明文件与命名空间，无需导入即可全局使用类型。</p><h3 id=定义后端数据接口>定义后端数据接口
<a class=header-anchor href=#%e5%ae%9a%e4%b9%89%e5%90%8e%e7%ab%af%e6%95%b0%e6%8d%ae%e6%8e%a5%e5%8f%a3></a></h3><p>定义完复现协议的逻辑代码后，那么就到前后端数据交互部分了，首先定义后端的接口，由于上面我们已经定义好了协议复现逻辑代码，这边只需要导入使用即可。就像下面这样</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Github</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;~~/server/protocol/github&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ResOp</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;~~/server/utils&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>defineEventHandler</span>(<span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>event</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>username</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>params</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>user</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>Github</span>.<span style=color:#a6e22e>getUser</span>(<span style=color:#a6e22e>username</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>login</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ResOp</span>.<span style=color:#a6e22e>error</span>(<span style=color:#ae81ff>404</span>, <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>??</span> <span style=color:#e6db74>&#39;User not found&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>useStorage</span>().<span style=color:#a6e22e>setItem</span>(<span style=color:#e6db74>`db:github:user:</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>username</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ResOp</span>.<span style=color:#a6e22e>success</span>(<span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>这一部分的代码建立在 Serverless Function 上，每一个接口都是以函数的方式对外暴露出去。这些代码会根据文件位置生成对应的路由，比如说上面的文件为 <code>server/api/user/[username].ts</code>，就映射为 <code>/api/user/:username</code>，前端请求 <code>/api/user/kuizuo</code> 通过<code>event.context.params.username</code> 便可以拿到 username 的值为 kuizuo。</p><p>至此后端部分就暂以告告落。</p><h3 id=定义前端状态管理>定义前端状态管理
<a class=header-anchor href=#%e5%ae%9a%e4%b9%89%e5%89%8d%e7%ab%af%e7%8a%b6%e6%80%81%e7%ae%a1%e7%90%86></a></h3><p>对于前端而言，肯定是需要全局管理一些数据状态的，这样能够在不同的组件间共享数据，并且需要持久化这些数据，以保证下次用户再次打开网页的时候无需向后台请求数据，pinia 持久化使用到了
<a href=https://github.com/prazdevs/pinia-plugin-persistedstate title=pinia-plugin-persistedstate rel="noopener external nofollow noreferrer" target=_blank class=exturl>pinia-plugin-persistedstate
<i class="fa fa-external-link-alt"></i></a> 插件。</p><p>同时在状态管理中，会定义一些方法来调用后端接口。如下演示</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useMessage</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;naive-ui&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>useUserStore</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>definePiniaStore</span>(<span style=color:#e6db74>&#39;user&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>user</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ref</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>API</span>.<span style=color:#a6e22e>User</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>&gt;</span>(<span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>repos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ref</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>API</span>.<span style=color:#a6e22e>Repo</span>[]<span style=color:#f92672>&gt;</span>([])
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useMessage</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getUser</span>(<span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>data</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>get</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>API</span>.<span style=color:#a6e22e>User</span><span style=color:#f92672>&gt;</span>(<span style=color:#e6db74>`/api/user/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>username</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>login</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>message</span>.<span style=color:#a6e22e>success</span>(<span style=color:#e6db74>&#39;获取成功&#39;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>message</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>message</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getRepos</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>username</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>value</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>login</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>data</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>get</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>API</span>.<span style=color:#a6e22e>Repo</span>[]<span style=color:#f92672>&gt;</span>(<span style=color:#e6db74>`/api/repo/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>username</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>repos</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>reset</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>repos</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>user</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>repos</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>getUser</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>getRepos</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>reset</span>,
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}, {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>persist</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>key</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;user&#39;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>这里的 http 是经过封装的，因为返回数据格式如：<code>{"code":200,"data":{},"message":"success"}</code> ，但对于业务逻辑而言，我们通常只需要关注 <code>data</code> 里面的数据，而请求的状态 code 与信息 message 则不是所要着重关系的对象。</p><p>至于想要返回原数据，还是带有 code, message 的数据，因人而异，我更喜欢后者将数据格式规范化，这样我就能知道本次请求的状态结果，在响应拦截器中就能够进行预先处理。</p><p>在 vue 组件中只需要使用演示如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>setup</span> <span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ts&#34;</span>&gt;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>username</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$ref</span>(<span style=color:#e6db74>&#39;kuizuo&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>loading</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$ref</span>(<span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userStore</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useUserStore</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>user</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$computed</span>(() =&gt; <span style=color:#a6e22e>userStore</span>.<span style=color:#a6e22e>user</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getUser</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>loading</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>userStore</span>.<span style=color:#a6e22e>getUser</span>(<span style=color:#a6e22e>username</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>loading</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><h3 id=编写前端页面与组件>编写前端页面与组件
<a class=header-anchor href=#%e7%bc%96%e5%86%99%e5%89%8d%e7%ab%af%e9%a1%b5%e9%9d%a2%e4%b8%8e%e7%bb%84%e4%bb%b6></a></h3><p>这一部分自由发挥即可了，这里我是集成了 NaiveUI 与 Unocss，足够应对大部分的前端开发需求。没什么过多要说的了。</p><h3 id=流程总结>流程总结
<a class=header-anchor href=#%e6%b5%81%e7%a8%8b%e6%80%bb%e7%bb%93></a></h3><p>整个开发流程就是这样的，如果我想要添加一个功能，用于获取 Github 用户已点的 Star 项目列表，那么按照上面流程将会清晰的实现出来。</p><p>这里仅举调用 Github api 为例，想调用其他第三方的 api 都不成问题，本模板只提供一个这样的开发流程（形态）能够帮助快速实现 Web 站点开发，同时极易部署，做到敏捷开发。</p><p>对比传统前后端分离的开发流程，这种开发流程可以说更加清晰，更加规范，更加高效。</p><h2 id=一些问题>一些问题
<a class=header-anchor href=#%e4%b8%80%e4%ba%9b%e9%97%ae%e9%a2%98></a></h2><h3 id=遇到图片防盗链怎么办>遇到图片防盗链怎么办?
<a class=header-anchor href=#%e9%81%87%e5%88%b0%e5%9b%be%e7%89%87%e9%98%b2%e7%9b%97%e9%93%be%e6%80%8e%e4%b9%88%e5%8a%9e></a></h3><p>我的做法相对比较简单粗暴，直接在图片中添加<code>referrerpolicy='no-referrer'</code> 就像下面这样。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>img</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;src&#34;</span> <span style=color:#a6e22e>referrerpolicy</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;no-referrer&#34;</span> /&gt;
</span></span></code></pre></div><p>如果你想要集成到 HTML 或者 CSS ，可以直接在 <code>&lt;head></code> 标签下添加如下代码.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;referrer&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;no-referrer&#34;</span> /&gt;
</span></span></code></pre></div><p>参阅
<a href=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Referrer-Policy title="Referrer-Policy - HTTP | MDN (mozilla.org)" rel="noopener external nofollow noreferrer" target=_blank class=exturl>Referrer-Policy - HTTP | MDN (mozilla.org)
<i class="fa fa-external-link-alt"></i></a></p><h3 id=跨域问题>跨域问题
<a class=header-anchor href=#%e8%b7%a8%e5%9f%9f%e9%97%ae%e9%a2%98></a></h3><p>几乎不会遇到跨域问题，因为所有的接口都相当于转发过一遍，不是由前端直接发送，而是后端接收到后，通过服务器来进行发送，然后将数据在返还给前端。</p><h2 id=考虑做的>考虑做的
<a class=header-anchor href=#%e8%80%83%e8%99%91%e5%81%9a%e7%9a%84></a></h2><h3 id=编写一个后台管理系统>编写一个后台管理系统
<a class=header-anchor href=#%e7%bc%96%e5%86%99%e4%b8%80%e4%b8%aa%e5%90%8e%e5%8f%b0%e7%ae%a1%e7%90%86%e7%b3%bb%e7%bb%9f></a></h3><p>这个模板如果要实现鉴权是相对比较简单的，前后端配置
<a href=https://v3.nuxtjs.org/guide/directory-structure/middleware title=Middleware rel="noopener external nofollow noreferrer" target=_blank class=exturl>Middleware
<i class="fa fa-external-link-alt"></i></a> 即可实现。使用 cookie 和 token 都随意，甚至第三方的登录。</p><p>但这时数据多了，难免需要去管理数据，不如专门为此编写一个后台管理系统，同时提供一个鉴权相关的功能。主要还是借助 ntrio 来开发，毕竟提供全栈开发能力，要实现只是时间开发的问题。</p><h3 id=使用-tauri-编译跨平台程序>使用 tauri 编译跨平台程序
<a class=header-anchor href=#%e4%bd%bf%e7%94%a8-tauri-%e7%bc%96%e8%af%91%e8%b7%a8%e5%b9%b3%e5%8f%b0%e7%a8%8b%e5%ba%8f></a></h3><p>编译成跨平台程序有一个好处，就是所有的流量请求与接收都是存放在用户的机器中，就相当于传统的桌面应用开发。而部署在 Web 端请求流量的压力都将会来到服务器上，就避免不了用户量大，导致请求缓慢，甚至 ip 被封禁的问题。</p><p>由于我暂且还不会 tauri 开发，也还不会 rust，所以这个功能估计得到寒假才有可能去实现了。electron 占用比较大的资源空间，不作为跨平台框架优先选择。</p><h2 id=写在最后>写在最后
<a class=header-anchor href=#%e5%86%99%e5%9c%a8%e6%9c%80%e5%90%8e></a></h2><p>这种开发形态自打我接触协议复现到前端开发我就考虑过，但奈何在没接触 ssr 框架之前，这种开发形态多半是需要前后端分离，要么使用模板语言，这样接口交互方面将会十分繁琐，开发效率过于低效。</p><p>因此当我发觉 ssr框架的可行性后，我几乎整整花费了两周的时间在不断的探索与完善中，希望将其编写成一个我日后随时都会用到的模板，即写即用，极速上线。因为这样的开发场景对我来说太过于常见了，而很多时间就是因为没有一个相应的模板与工具库，代码总是东凑西凑，后续维护与测试总是花费不小的时间去解决。</p><p>目前这种方案已有初步雏形，由于一些特殊的因素，我并未将已经写过的站点作为案例放在这上面作为演示，而将 Github api 作为演示，后续大概率会弄个案例展示供参考学习。</p><p>后续我还是会不断去完善与维护该项目，并基于该项目去重构我的一些项目。</p><p><strong>本模板仅仅是 web 模板，任何开发者用该模板做什么样的站点都与本人无关。仅作为个人技术专研，仅供学习参考。</strong></p></div><footer class=post-footer><div class=post-tags><a href=/tags/project>project</a>
<a href=/tags/protocol>protocol</a>
<a href=/tags/template>template</a>
<a href=/tags/nuxt3>nuxt3</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="爸比娃娃 - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="爸比娃娃 - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
Protocol 协议复现模板</li><li class=post-copyright-author><strong>本文作者：</strong>
爸比娃娃</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://blog.jiandan.cf/post/project/protocol-template/ title="Protocol 协议复现模板">https://blog.jiandan.cf/post/project/protocol-template/</a></li><li class=post-copyright-license><strong>版权声明：</strong>
本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i></span>
<span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/atom.xml><span class=icon><i class="fa fa-rss"></i></span>
<span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/project/refactor-kz-admin/ rel=next title=重构kz-admin><i class="fa fa-chevron-left"></i> 重构kz-admin</a></div><div class="post-nav-prev post-nav-item"><a href=/post/develop/rollup-js-experience/ rel=prev title="rollup.js 初体验">rollup.js 初体验
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=waline-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>爸比娃娃</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.116.1 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>粤ICP备 18047355-1 号</a>
<img src=/imgs/gongan.png alt=沪公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011402009770" target=_blank>沪公网安备 31011402009770 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel></a>
<a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云></a>
<a target=_blank href=https://webify.cloudbase.net title=Webify>Webify</a>
<span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://blog.jiandan.cf/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o \n\n可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄\n(Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.0fb3547374c917d23a2e5f762b70f3698d20b46a01cc18c38f9c467aeffc99fc.js defer></script></body></html>